# d3antispam

Пример простого алгоритма, обнаруживающего (и в меру возможностей наказывающего) спам на d3.ru

## Пример использования
~~~~
$ export D3USER=YourUsername
$ export D3PASS='YourPassword'
$ ./d3antispam.py --period 5h --body 'SPAM DETECTED! https://github.com/d3xenon/d3antispam'
~~~~

## Аутентификация
Для реакции на спам, требуется пройти аутентификацию на д3. Есть два способа для этого.

### Аутентификация по паролю
При этом способе аутентификации, используйте параметры `--user` и `--password`. Значения этих параметров по-умолчанию берется из переменных окружения `D3USER` и `D3SPAM`, таким образом, если установить эти переменные, но можно запускать d3antispam без указания имени-пароля.

На d3 есть ограничение по количеству аутентификации за период времени (действует даже на успешную аутентификацию), поэтому, если вы запустили d3antispam несколько раз подряд, иногда он может дать сбой на этапе аутентификации. Нужно просто подождать и попробовать снова.

После успешного входа, d3antispam пишет id пользователя и sid:
~~~
sid: 333b2a44b607e91a7a310fdb610a9d44 uid: 12345
~~~

### Аутентификация через SID
Полученный sid/uid можно использовать повторно (пока sid не протухнет).
для этого можно передать их через параметры `--sid` и `--uid`. Значения по умолчанию берутся из окружения `D3SID`/`D3UID`. Значения можно взять из вывода `d3antispam.py --me --user USER --pass PASS`.

Этот способ лучше тем, что на него не действует ограничение на количество логинов за время, так что он лучше если вы запускаете d3antispam много раз подряд.

## Реакция 
Когда спам-пользователь обнаружен, d3antispam может влиять на посты несколькими способами.

Если указана опция `--minus`, посту будет выставлен минус.

Если указана опция `--body TEXT`, в посте будет оставлен высокомерный язвительный комментарий. Текст комментария нужно придумать пользователю.

Если указана опция `--unpublish` пост будет распубликован. Это работает только в ситуации, когда пользователь имеет право на это (например, является модератором подсайта).

Все три опции можно указывать одновременно.

## Ограничения
- d3antispam не может делать то, чего не может юзер, от имени которого работает
- d3 имеет ограничение на количество логина-минусований-комментариев в короткий период времени (d3antispam просто игнорирует ошибку). 

## Протокол работы

https://gist.github.com/d3xenon/7e1cd876f4e1b6b425a936197a14d9ca
